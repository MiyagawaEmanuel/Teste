@model TaskQuest.ViewModels.GrupoViewModel

@{
    ViewBag.Title = "Grupo";
}

@section css
{
	<link rel="stylesheet" href="~/Content/css/grupo.css">
	<link rel="stylesheet" href="~/Content/css/spectrum.css">
    <link href="~/Content/js/jquery-ui/jquery-ui.css" rel="stylesheet" />	
}

@section js
{
	<script src="~/Content/js/spectrum.js"></script>
	<script src="~/Content/js/canvas/canvasjs.min.js"></script>
	<script src="~/Content/js/graphics.js"></script>
	<script src="~/Content/js/spectrum.config.js"></script>
	<script src="~/Content/js/jquery-ui/jquery-ui.js"></script>
	<script src="~/Content/js/tabs.js"></script>
	<script src="~/Content/js/jquery.validate.js"></script>
	<script src="~/Content/js/grupo.js"></script>	
    <script src="~/Content/js/link.js"></script>
    <script src="~/Content/js/showBalloon.js"></script>
    <script src="~/Content/js/integrante.js"></script>
}

<section class="pads-bot">

	<div class="flex-properties-r">
		<div class="title-a" style="color: @User.Identity.GetCor()"><h2>Grupo</h2></div>
		<div class="title-b">
			<div class="flex-properties-r pads icon-black">
				@Html.Partial("_LinkPartial", new TaskQuest.ViewModels.LinkViewModel("CriarQuest", Model.Id, "/Quest/CriarQuest", false))
                <a onclick="link(CriarQuest)"><i class="fa fa-plus elipse" aria-hidden="true"></i></a>
                <h3><a onclick="link(CriarQuest)">Criar Quest</a></h3>
			</div>
			<div class="flex-properties-r pads icon-black">
                @Html.Partial("_LinkPartial", new TaskQuest.ViewModels.LinkViewModel("ExcluirGrupo", Model.Id, "/Grupo/ExcluirGrupo", false))
				<a onclick="link(ExcluirGrupo)"><i class="fa fa-times elipse" aria-hidden="true"></i></a>
				<h3><a onclick="link(ExcluirGrupo)">Excluir Grupo</a></h3>
			</div>
		</div>
	</div>

</section>

<section>
	<div class="container">
		<div id="chartContainer"></div>
	</div>
</section>

<hr class="container quebra">

<section class="container flex-properties-g">
	<div>
		<div class="grupo-elipse" style="background-color: @Model.Cor"><img src="~/Content/img/groupicon.png"></div>
	</div>
	<div class="limit-lines limit-lines_grupo" title="@Model.Nome"><h3>@Model.Nome</h3></div>
    @if (@Model.Integrantes.Count == 1)
    {
        <div><h3>@Model.Integrantes.Count Integrante</h3></div>
    }
    else
    {
        <div><h3>@Model.Integrantes.Count Integrantes</h3></div>
    }
	<div class="icon-black"><a><i class="fa fa-plus" title="Adicionar Integrante" aria-hidden="true" data-target="#modalAdicionarIntegrante" data-toggle="modal"></i></a></div>
</section>

<hr class="container quebra">

<section class="container">
	<div id="tabs">
		<ul>
			<li><a href="#integrantes">Integrantes</a></li>
			<li><a href="#quests">Quests</a></li>
		</ul>
        <div id="integrantes" data-rel="@Model.Id">
            @foreach (var integrante in Model.Integrantes)
            {
                <div class="user-container">
                    <p class="user-title integrante" data-email="@integrante.Email">&bull; @integrante.Nome</p>
                    @if (!integrante.Claims.ToList().Any(q => Util.Encrypt(q.ClaimType) == Model.Id && q.ClaimValue == "Adm"))
                    {
                        <a class="icon-black" onclick="popularConfirmacaoModal('@integrante.Email', '/Grupo/TornarAdministrador')" data-target="#modalConfirmacao" data-toggle="modal"><i class="fa fa-user" aria-hidden="true"></i></a>
                        <a class="icon-black" onclick="popularConfirmacaoModal('@integrante.Email', '/Grupo/ExcluirIntegrante')" data-target="#modalConfirmacao" data-toggle="modal"><i class="fa fa-times" aria-hidden="true"></i></a>
                    }
                </div>
            }
        </div>

        <div id="quests">
            @for (int x = 0; x < Model.Quests.Count; x++)
            {
                <div class="quest-container icon-black questlist-g">
                    <i class="fa fa-circle bull" aria-hidden="true" style="color: @Model.Quests.ToList()[x].Cor"></i>
                    @Html.Partial("_LinkPartial", new TaskQuest.ViewModels.LinkViewModel("Grupo" + x, Model.Quests.ToList()[x].Id.ToString(), "/Quest"))
                    <a onclick="link(@Html.ToString("Grupo"+x))"><h4 class="quest-container">@Model.Quests.ToList()[x].Nome</h4></a>
                </div>
            }
        </div>
	</div>
</section>

<hr class="container quebra">

@Html.Partial("_AdicionarIntegrantePartial", new TaskQuest.ViewModels.IntegranteViewModel(Model.Id))

<div class="modal fade" id="modalConfirmacao" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title" id="exampleModalLabel">Você tem certeza?</h1>
            </div>
            <form method="post" id="formConfirmacao">
                @Html.AntiForgeryToken()
                <div class="modal-footer modalfooter-container">
                    <input type="hidden" name="Email" />
                    <input type="hidden" name="GrupoId" value="@Model.Id" />
                    <input type="submit" class="btn btn-secondary btn-cg" value="Sim">
                    <input type="submit" data-dismiss="modal" class="btn btn-secondary btn-cg" value="Não">
                </div>
            </form>
        </div>
    </div>
</div>

@Html.Partial("_ModalIntegrantePartial")